{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { ContratoHelper } from './contrato.helper';\nimport { TipoDocumentoEnum, TipoAssinatura, TipoAutenticacao } from './contrato.enum';\nimport { DadosContratanteDocumentoModelo } from './contrato.model';\nimport { API, URL_CONTRATO_PDF, CHAVE_CONTRATO_MODELO, DADOS_CONTRATATANTE_DOCUMENTO_MODELO } from \"../../environments/environment\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./contrato.service\";\nimport * as i2 from \"@angular/common\";\nconst _c0 = [\"contrato\"];\n\nfunction ContratoComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 3);\n  }\n}\n\nexport let ContratoComponent = /*#__PURE__*/(() => {\n  class ContratoComponent {\n    constructor(contratoService) {\n      this.contratoService = contratoService;\n      this.contrato = null;\n      this.dadosContratante = new DadosContratanteDocumentoModelo();\n      this.tipoDocumento = TipoDocumentoEnum.UPLOAD;\n      this.contratoAssinado = new EventEmitter();\n      this.carregando = true;\n      this.chaveDocumento = '';\n      this.chaveSignatarioContratado = '';\n      this.chaveSignatarioContratante = '';\n      this.chaveRequisicaoAssinaturaContratado = '';\n      this.chaveRequisicaoAssinaturaContratante = '';\n    }\n\n    ngOnInit() {\n      this.tipoDocumento === TipoDocumentoEnum.MODELO ? this.criarContratoPorModelo() : this.criarContratoPorUpload();\n    }\n\n    criarContratoPorUpload() {\n      ContratoHelper.obterContratoBase64(URL_CONTRATO_PDF).then(contratoBase64 => {\n        const documento = {\n          document: {\n            key: '',\n            content_base64: contratoBase64,\n            path: '/' + ContratoHelper.obterNomeArquivo(this.dadosContratante.nomeCompleto, this.tipoDocumento)\n          }\n        };\n        this.contratoService.criarDocumentoViaUpload(documento).subscribe(data => {\n          this.chaveDocumento = data.document.key;\n          this.criarSignatarioContratante();\n        }, error => {\n          this.carregando = false;\n          throw new Error(error);\n        });\n      }).catch(error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    criarContratoPorModelo() {\n      const documento = {\n        document: {\n          key: '',\n          path: '/' + ContratoHelper.obterNomeArquivo(this.dadosContratante.nomeCompleto, this.tipoDocumento),\n          template: {\n            data: {\n              cpf: this.dadosContratante.cpf,\n              email: this.dadosContratante.email,\n              nomeCompleto: this.dadosContratante.nomeCompleto,\n              dataNascimento: this.dadosContratante.dataNascimento\n            }\n          }\n        }\n      };\n      this.contratoService.criarDocumentoViaModelo(documento, CHAVE_CONTRATO_MODELO).subscribe(data => {\n        this.chaveDocumento = data.document.key;\n        this.criarSignatarioContratante();\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    criarSignatarioContratante() {\n      const signatario = {\n        signer: {\n          key: '',\n          auths: [TipoAutenticacao.EMAIL],\n          email: this.dadosContratante.email,\n          documentation: this.dadosContratante.cpf,\n          name: this.dadosContratante.nomeCompleto,\n          birthday: this.dadosContratante.dataNascimento\n        }\n      };\n      this.contratoService.criarSignatario(signatario).subscribe(data => {\n        this.chaveSignatarioContratante = data.signer.key;\n        this.criarSignatarioContratado();\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    criarSignatarioContratado() {\n      const signatario = {\n        signer: {\n          key: '',\n          auths: [TipoAutenticacao.EMAIL],\n          name: DADOS_CONTRATATANTE_DOCUMENTO_MODELO.nomeResponsavel,\n          email: DADOS_CONTRATATANTE_DOCUMENTO_MODELO.emailResponsavel,\n          documentation: DADOS_CONTRATATANTE_DOCUMENTO_MODELO.cpfResponsavel,\n          birthday: DADOS_CONTRATATANTE_DOCUMENTO_MODELO.dataNascimentoResponsavel\n        }\n      };\n      this.contratoService.criarSignatario(signatario).subscribe(data => {\n        this.chaveSignatarioContratado = data.signer.key;\n        this.adicionarSignatarioContratanteAoDocumento();\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    adicionarSignatarioContratanteAoDocumento() {\n      const signatarioDocumento = {\n        list: {\n          key: '',\n          request_signature_key: '',\n          document_key: this.chaveDocumento,\n          sign_as: TipoAssinatura.CONTRATANTE,\n          signer_key: this.chaveSignatarioContratante\n        }\n      };\n      this.contratoService.adicionarSignatarioADocumento(signatarioDocumento).subscribe(data => {\n        this.chaveRequisicaoAssinaturaContratante = data.list.request_signature_key;\n        this.adicionarSignatarioContratadoAoDocumento();\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    adicionarSignatarioContratadoAoDocumento() {\n      const signatarioDocumento = {\n        list: {\n          key: '',\n          request_signature_key: '',\n          document_key: this.chaveDocumento,\n          sign_as: TipoAssinatura.CONTRATADO,\n          signer_key: this.chaveSignatarioContratado\n        }\n      };\n      this.contratoService.adicionarSignatarioADocumento(signatarioDocumento).subscribe(data => {\n        this.chaveRequisicaoAssinaturaContratado = data.list.request_signature_key;\n        this.enviarNotificacaoAssinarDocumento();\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    enviarNotificacaoAssinarDocumento() {\n      this.contratoService.enviarNotificacaoAssinaturaDocumento(this.chaveRequisicaoAssinaturaContratado).subscribe(() => {\n        this.exibirContrato(this.chaveRequisicaoAssinaturaContratante);\n      }, error => {\n        this.carregando = false;\n        throw new Error(error);\n      });\n    }\n\n    exibirContrato(requestSignatureKey) {\n      if (!this.contrato) {\n        throw new Error('Não foi encontrado o elemento \"contrato\"');\n      }\n\n      const widget = new Clicksign(requestSignatureKey);\n      widget.origin = window.origin;\n      widget.endpoint = API.apiClickSign;\n      widget.mount(this.contrato.nativeElement.id);\n      widget.on('signed', () => {\n        this.onContratoAssinado();\n      });\n      widget.on('loaded', () => {\n        this.onContratoCarregado();\n      });\n    }\n\n    onContratoAssinado() {\n      this.contratoAssinado.emit();\n    }\n\n    onContratoCarregado() {\n      this.carregando = false;\n    }\n\n  }\n\n  ContratoComponent.ɵfac = function ContratoComponent_Factory(t) {\n    return new (t || ContratoComponent)(i0.ɵɵdirectiveInject(i1.ContratoService));\n  };\n\n  ContratoComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ContratoComponent,\n    selectors: [[\"app-contrato\"]],\n    viewQuery: function ContratoComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.contrato = _t.first);\n      }\n    },\n    inputs: {\n      dadosContratante: \"dadosContratante\",\n      tipoDocumento: \"tipoDocumento\"\n    },\n    outputs: {\n      contratoAssinado: \"contratoAssinado\"\n    },\n    decls: 3,\n    vars: 4,\n    consts: [[\"class\", \"loader\", 4, \"ngIf\"], [\"id\", \"contrato\", 1, \"contrato\", 3, \"hidden\"], [\"contrato\", \"\"], [1, \"loader\"]],\n    template: function ContratoComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ContratoComponent_div_0_Template, 1, 0, \"div\", 0);\n        i0.ɵɵelement(1, \"div\", 1, 2);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.carregando);\n        i0.ɵɵadvance(1);\n        i0.ɵɵclassProp(\"fadeIn\", !ctx.carregando);\n        i0.ɵɵproperty(\"hidden\", ctx.carregando);\n      }\n    },\n    directives: [i2.NgIf],\n    styles: [\".contrato[_ngcontent-%COMP%]{width:100%;height:100%}.fadeIn[_ngcontent-%COMP%]{opacity:0;animation:fadeIn 1.3s ease-in-out forwards;-webkit-animation:fadeIn 1.3s ease-in-out forwards}.loader[_ngcontent-%COMP%], .loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{width:1.5em;height:1.5em;border-radius:50%;animation-fill-mode:both;-webkit-animation-fill-mode:both;animation:loading 1.8s ease-in-out infinite;-webkit-animation:loading 1.8s ease-in-out infinite}.loader[_ngcontent-%COMP%]{font-size:10px;margin:80px auto;position:relative;text-indent:-9999em;animation-delay:-.16s;transform:translateZ(0);color:#2a93e9;-ms-transform:translateZ(0);-webkit-animation-delay:-.16s;-webkit-transform:translateZ(0)}.loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{top:0;content:\\\"\\\";position:absolute}.loader[_ngcontent-%COMP%]:before{left:-3.5em;animation-delay:-.32s;-webkit-animation-delay:-.32s}.loader[_ngcontent-%COMP%]:after{left:3.5em}@keyframes loading{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}\"]\n  });\n  return ContratoComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}